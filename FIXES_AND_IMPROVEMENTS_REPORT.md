# üéØ –û—Ç—á–µ—Ç –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –¢–ó

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏:

### 1. ‚ùå –û—à–∏–±–∫–∞: `relation "player_sessions" does not exist`
**–§–∞–π–ª:** `src/routes/profile.js:110`
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –ó–∞–º–µ–Ω–µ–Ω –∑–∞–ø—Ä–æ—Å –∫ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ç–∞–±–ª–∏—Ü–µ `player_sessions` –Ω–∞ –∑–∞–ø—Ä–æ—Å –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π `daily_stats`
```javascript
// –ë—ã–ª–æ:
SELECT * FROM player_sessions WHERE user_id = $1

// –°—Ç–∞–ª–æ:
SELECT stat_date, playtime_minutes, blocks_broken, blocks_placed, logins_count 
FROM daily_stats WHERE user_id = $1
```

### 2. ‚ùå –û—à–∏–±–∫–∞: `column "discord_tag" does not exist`
**–§–∞–π–ª:** `src/routes/admin.js:136`
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –ó–∞–º–µ–Ω–µ–Ω–æ `u.discord_tag` –Ω–∞ `u.discord_username`
```javascript
// –ë—ã–ª–æ:
SELECT u.id, u.nickname, u.email, u.discord_tag, u.trust_level

// –°—Ç–∞–ª–æ:
SELECT u.id, u.nickname, u.email, u.discord_username, u.trust_level
```

### 3. ‚ùå –û—à–∏–±–∫–∞: `column "created_at" does not exist`
**–§–∞–π–ª—ã:** `src/routes/applications.js:547`, `src/routes/trust-level.js:125`
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –ó–∞–º–µ–Ω–µ–Ω–æ `created_at` –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∫–æ–ª–æ–Ω–∫—É `submitted_at`
```javascript
// –ë—ã–ª–æ:
ORDER BY created_at DESC

// –°—Ç–∞–ª–æ:
ORDER BY submitted_at DESC
```

### 4. ‚ùå –û—à–∏–±–∫–∞: –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∞—è –∫–æ–ª–æ–Ω–∫–∞ `total_minutes`
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ `total_minutes` –≤ —Ç–∞–±–ª–∏—Ü—É `users` —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π:
```sql
ALTER TABLE users ADD COLUMN total_minutes INTEGER DEFAULT 0;

-- –¢—Ä–∏–≥ger –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
CREATE TRIGGER trigger_sync_user_total_minutes
    AFTER UPDATE OF time_played_minutes ON player_stats
    FOR EACH ROW
    EXECUTE FUNCTION sync_user_total_minutes();
```

## ‚úÖ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¢–ó –ø–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º:

### 1. üéÆ Discord field consolidation
‚úÖ **–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ:** "discord id/discord tag (–∏—Ö –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –æ–±—ä–µ–¥–µ–Ω–∏—Ç—å –≤ –æ–¥–∏–Ω)"
**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ö–æ–ª–æ–Ω–∫–∞ `discord_username` –≤ —Ç–∞–±–ª–∏—Ü–µ `users`
- API endpoints: `/api/auth/link-discord`, `/api/auth/unlink-discord`
- OAuth2 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–µ—Å—Å–∏–æ–Ω–Ω—ã–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º
- –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º Discord

### 2. üë§ Age system
‚úÖ **–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ:** "age (–ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π –∑–∞—è–≤–∫–∏ –Ω–∞ –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä—É, —Ç–∞–º –∂–µ –Ω—É–∂–Ω–æ —Å–ø–∏—Å–∞—Ç—å –≤–æ–∑—Ä–∞—Å—Ç)"
**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ö–æ–ª–æ–Ω–∫–∞ `age` –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö `users` –∏ `applications`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç—Ä–∏–≥ger `save_age_from_application`
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–æ–∑—Ä–∞—Å—Ç–∞ –≤ –ø—Ä–æ—Ñ–∏–ª–µ –∏ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏

### 3. üìù Bio system  
‚úÖ **–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ:** "bio (–Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –¥–ª—è —Ñ–æ—Ä—É–º–∞ –∏ –¥–æ–±–∞–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É –±–∏–æ –≤ –ø—Ä–æ—Ñ–∏–ª—å)"
**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ö–æ–ª–æ–Ω–∫–∞ `bio` TEXT –≤ —Ç–∞–±–ª–∏—Ü–µ `users`
- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –ø—Ä–æ—Ñ–∏–ª–µ —Å —Å—á–µ—Ç—á–∏–∫–æ–º —Å–∏–º–≤–æ–ª–æ–≤ (–º–∞–∫—Å. 500)
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–∏–æ –≤ –ø—Ä–æ—Ñ–∏–ª–µ –∏ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏

### 4. üñºÔ∏è Avatar system
‚úÖ **–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ:** "avatar_url (–Ω—É–∂–Ω–æ –µ—ë —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –∑–∞–≥—Ä—É–∂–∞—å —Å–≤–æ—é –∞–≤–∞—Ç–∞—Ä–∫—É)"
**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ö–æ–ª–æ–Ω–∫–∞ `avatar_url` –≤ —Ç–∞–±–ª–∏—Ü–µ `users`
- API endpoint `/api/profile/avatar` —Å multer
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤: JPEG, PNG, GIF, WebP (–¥–æ 5MB)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –∞–≤–∞—Ç–∞—Ä–æ–∫
- –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–∑–¥–∞—á–∞ —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ `/uploads`

### 5. ‚öñÔ∏è Ban system improvements
‚úÖ **–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ:** "ban_reason (–æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø—Ä–∏—á–∏–Ω–∞—Ö –±–∞–Ω–∞ –∏ —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –Ω—É–∂–Ω–æ –¥–æ–ø–æ–ª–Ω–∏—Ç—å —Ç–µ–º, —á—Ç–æ–±—ã –≤ –ø—Ä–æ—Ñ–∏–ª–µ –ø–æ–∫–∞–∑—ã–≤–∞–ª–æ —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–∞–Ω–µ–Ω)"
**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ö–æ–ª–æ–Ω–∫–∏ `ban_reason` –∏ `ban_until` –≤ —Ç–∞–±–ª–∏—Ü–µ `users`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç—Ä–∏–≥ger `check_ban_expiry` –¥–ª—è —Å–Ω—è—Ç–∏—è –∏—Å—Ç–µ–∫—à–∏—Ö –±–∞–Ω–æ–≤
- API endpoint `/api/profile/ban-status` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –≤ –ø—Ä–æ—Ñ–∏–ª–µ –¥–ª—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –†–∞—Å—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –¥–æ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

## üõ†Ô∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:

### 1. üîÑ Database Triggers
- **check_ban_expiry()** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–Ω—è—Ç–∏–µ –∏—Å—Ç–µ–∫—à–∏—Ö –±–∞–Ω–æ–≤
- **save_age_from_application()** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–æ–∑—Ä–∞—Å—Ç–∞ –∏–∑ –∑–∞—è–≤–æ–∫  
- **sync_user_total_minutes()** - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∏–≥—Ä—ã

### 2. üé® Frontend –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å —Å –Ω–æ–≤—ã–º–∏ –ø–æ–ª—è–º–∏
- Discord OAuth –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å callback –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
- –ê–≤–∞—Ç–∞—Ä –º–µ–Ω–µ–¥–∂–µ—Ä —Å –ø—Ä–µ–≤—å—é –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –±–∞–Ω–∞—Ö —Å —Ç–∞–π–º–µ—Ä–æ–º

### 3. üëë Admin –ø–∞–Ω–µ–ª—å
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ê–≤–∞—Ç–∞—Ä—ã –≤ —Å–ø–∏—Å–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ Discord –∞–∫–∫–∞—É–Ω—Ç–∞—Ö
- –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –º–æ–¥–∞–ª—å–Ω–∞—è —Ñ–æ—Ä–º–∞ —Å –±–∏–æ –∏ –≤–æ–∑—Ä–∞—Å—Ç–æ–º

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π:

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:
- ‚úÖ 7 –Ω–æ–≤—ã—Ö –∫–æ–ª–æ–Ω–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–æ
- ‚úÖ 3 —Ç—Ä–∏–≥ger —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω—ã
- ‚úÖ 1 –Ω–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ (`discord_oauth`)

### Backend (API):
- ‚úÖ 6 –Ω–æ–≤—ã—Ö endpoints
- ‚úÖ 4 —Ñ–∞–π–ª–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–æ
- ‚úÖ Multer –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤

### Frontend:
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω –ø—Ä–æ—Ñ–∏–ª—å (`public/profile.html`)
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å (`public/admin.html`)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∞–≤–∞—Ç–∞—Ä–æ–∫ –∏ Discord OAuth

## üöÄ –†–µ–∑—É–ª—å—Ç–∞—Ç:
–í—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¢–ó —É—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã. –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å –ø–æ–ª–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, –≤–∫–ª—é—á–∞—è Discord –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é, –∞–≤–∞—Ç–∞—Ä—ã, –±–∏–æ–≥—Ä–∞—Ñ–∏–∏, —Å–∏—Å—Ç–µ–º—É –±–∞–Ω–æ–≤ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–æ–∑—Ä–∞—Å—Ç–∞.
