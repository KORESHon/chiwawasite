// –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Ç–æ–≥–æ–≤—ã—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π: TPS, uptime, –ø—Ä–∞–≤–∏–ª–∞, JWT —Ç–æ–∫–µ–Ω—ã
const axios = require('axios');

async function testFinalFixes() {
    console.log('üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ò–¢–û–ì–û–í–´–• –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô');
    console.log('=====================================\n');
    
    try {
        // 1. –¢–µ—Å—Ç–∏—Ä—É–µ–º —É–±—Ä–∞–Ω–Ω—ã–µ –∑–∞–≥–ª—É—à–∫–∏ TPS –∏ uptime
        console.log('1Ô∏è‚É£ –¢–ï–°–¢–ò–†–£–ï–ú –£–ë–†–ê–ù–ù–´–ï –ó–ê–ì–õ–£–®–ö–ò');
        console.log('-------------------------------');
        
        const response = await axios.get('http://localhost:3000/api/settings/server-info');
        const data = response.data;
        
        console.log('üìä –î–∞–Ω–Ω—ã–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:');
        console.log('   TPS:', data.performance?.tps);
        console.log('   Ping:', data.performance?.ping);
        console.log('   Uptime:', data.server?.uptime);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ TPS —Ç–µ–ø–µ—Ä—å null (–Ω–µ –∑–∞–≥–ª—É—à–∫–∞ 20.0)
        if (data.performance?.tps === null) {
            console.log('   ‚úÖ TPS –∑–∞–≥–ª—É—à–∫–∞ —É–±—Ä–∞–Ω–∞ (–ø–æ–ª—É—á–∞–µ—Ç—Å—è –æ—Ç –ø–ª–∞–≥–∏–Ω–∞)');
        } else if (data.performance?.tps === 20.0) {
            console.log('   ‚ùå TPS –≤—Å–µ –µ—â–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–∞–≥–ª—É—à–∫—É 20.0');
        } else {
            console.log('   ‚ö†Ô∏è  TPS –∏–º–µ–µ—Ç –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:', data.performance?.tps);
        }
        
        console.log('\n2Ô∏è‚É£ –¢–ï–°–¢–ò–†–£–ï–ú –°–¢–†–ê–ù–ò–¶–£ –ü–†–ê–í–ò–õ');
        console.log('-------------------------------');
        
        try {
            const rulesResponse = await axios.get('http://localhost:3000/rules');
            if (rulesResponse.data.includes('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')) {
                console.log('   ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–∞–≤–∏–ª –∑–∞–º–µ–Ω–µ–Ω–∞ –Ω–∞ –∑–∞–≥–ª—É—à–∫—É');
                console.log('   ‚úÖ –°–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–µ—Ä–µ–Ω–æ—Å–µ –Ω–∞ —Ñ–æ—Ä—É–º');
            } else {
                console.log('   ‚ùå –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–∞–≤–∏–ª –Ω–µ –∏–∑–º–µ–Ω–µ–Ω–∞');
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
            if (rulesResponse.data.includes('–ò–ù–§–û–†–ú–ê–¶–ò–Ø –î–õ–Ø –†–ê–ó–†–ê–ë–û–¢–ß–ò–ö–ê')) {
                console.log('   ‚úÖ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω—ã');
            }
            
        } catch (error) {
            console.log('   ‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∞–≤–∏–ª:', error.message);
        }
        
        console.log('\n3Ô∏è‚É£ –¢–ï–°–¢–ò–†–£–ï–ú FRONTEND –ò–ó–ú–ï–ù–ï–ù–ò–Ø');
        console.log('-------------------------------');
        
        try {
            const onlineResponse = await axios.get('http://localhost:3000/online');
            if (onlineResponse.data.includes('calculateUptime')) {
                console.log('   ‚ùå –§—É–Ω–∫—Ü–∏—è calculateUptime –≤—Å–µ –µ—â–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç');
            } else {
                console.log('   ‚úÖ –ó–∞–≥–ª—É—à–∫–∞ calculateUptime —É–¥–∞–ª–µ–Ω–∞');
            }
            
            if (onlineResponse.data.includes('serverStartTime')) {
                console.log('   ‚ùå –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è serverStartTime –≤—Å–µ –µ—â–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç');
            } else {
                console.log('   ‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è serverStartTime —É–¥–∞–ª–µ–Ω–∞');
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É TPS
            if (onlineResponse.data.includes('tps === null')) {
                console.log('   ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ null TPS');
            }
            
        } catch (error) {
            console.log('   ‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ–Ω–ª–∞–π–Ω:', error.message);
        }
        
        console.log('\n4Ô∏è‚É£ –¢–ï–°–¢–ò–†–£–ï–ú JWT –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø');
        console.log('-------------------------------');
        
        // –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π error handling)
        try {
            await axios.get('http://localhost:3000/api/plugin/server-access?nickname=test', {
                headers: {
                    'Authorization': 'Bearer invalid_token_12345'
                }
            });
        } catch (error) {
            if (error.response && error.response.status === 403) {
                console.log('   ‚úÖ –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (403)');
                console.log('   ‚úÖ –û—à–∏–±–∫–∞ JWT –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç crash —Å–µ—Ä–≤–µ—Ä–∞');
            } else {
                console.log('   ‚ö†Ô∏è  –ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω:', error.response?.status);
            }
        }
        
        console.log('\nüìã –†–ï–ó–Æ–ú–ï –ò–ó–ú–ï–ù–ï–ù–ò–ô');
        console.log('===================');
        console.log('‚úÖ TPS –∑–∞–≥–ª—É—à–∫–∞ —É–±—Ä–∞–Ω–∞ - —Ç–µ–ø–µ—Ä—å null –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç –ø–ª–∞–≥–∏–Ω–∞');
        console.log('‚úÖ Uptime –∑–∞–≥–ª—É—à–∫–∞ —É–±—Ä–∞–Ω–∞ - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è N/A');
        console.log('‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–∞–≤–∏–ª –∑–∞–º–µ–Ω–µ–Ω–∞ –Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—É—é –∑–∞–≥–ª—É—à–∫—É');
        console.log('‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –≤ HTML –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏');
        console.log('‚úÖ JWT —Ç–æ–∫–µ–Ω—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –±–µ–∑ –æ—à–∏–±–æ–∫ malformed');
        console.log('‚úÖ Frontend –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ');
        
        console.log('\nüîß –ß–¢–û –ù–£–ñ–ù–û –°–î–ï–õ–ê–¢–¨ –î–ê–õ–ï–ï:');
        console.log('==========================');
        console.log('1. –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –ø–ª–∞–≥–∏–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä');
        console.log('2. –°–æ–∑–¥–∞—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç –≤ –ø–ª–∞–≥–∏–Ω–µ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ TPS');
        console.log('3. –°–æ–∑–¥–∞—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç –≤ –ø–ª–∞–≥–∏–Ω–µ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ uptime —Å–µ—Ä–≤–µ—Ä–∞');
        console.log('4. –ó–∞–º–µ–Ω–∏—Ç—å –∑–∞–≥–ª—É—à–∫—É –ø—Ä–∞–≤–∏–ª –Ω–∞ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É');
        console.log('5. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ñ–æ—Ä—É–º –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª (–≤—Ä–µ–º–µ–Ω–Ω–æ)');
        
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:', error.message);
    }
}

testFinalFixes();
